version: 2.1 # use CircleCI 2.1
jobs: # a collection of steps
  build: # runs not using Workflows must have a `build` job as entry point
    
    working_directory: ~/working-dir # directory where steps will run

    docker: # run the steps with Docker
      - image: circleci/openjdk:8-jdk-stretch-browsers # ...with this image as the primary container; this is where all `steps` will run

    steps: # a collection of executable commands

      - checkout # check out source code to working directory

      - restore_cache: # restore the saved cache after the first run or if `pom.xml` has changed
          # Read about caching dependencies: https://circleci.com/docs/2.0/caching/
          key: working-dir-{{ checksum "pom.xml" }}
      
      - run: mvn dependency:go-offline # gets the project dependencies
      
 
 
      - save_cache: # saves the project dependencies
          paths:
            - ~/.m2
          key: working-dir-{{ checksum "pom.xml" }}
 
      # Debugging
      - run: ls -al
      - run: pwd

      - run:
          name: Install latest version of ChromeDriver Sample
          command: |
            sudo wget https://chromedriver.storage.googleapis.com/2.31/chromedriver_linux64.zip
            sudo unzip chromedriver_linux64.zip
            sudo rm chromedriver_linux64.zip
            sudo mv chromedriver /usr/bin/
            sudo chmod 777 /usr/bin/chromedriver
           # sudo apt-get install libxi6 libgconf-2-4
           # sudo apt-get -y install xvfb gtk2-engines-pixbuf
           # sudo apt-get -y install xfonts-cyrillic xfonts-100dpi xfonts-75dpi xfonts-base xfonts-scalable
           # sudo apt-get install xvfb
           # sudo apt-get -y install imagemagick x11-apps
      
      - run: mvn test -PFull # run the actual tests
      
 #     - store_test_results: # uploads the test metadata from the `target/surefire-reports` directory so that it can show up in the CircleCI dashboard. 
      # Upload test results for display in Test Summary: https://circleci.com/docs/2.0/collect-test-data/
 #         path: target/surefire-reports
 
     - run:
          name: Save test results
          command: |
            mkdir -p ~/test-results/junit/
            find . -type f -regex ".*/target/surefire-reports/.*xml" -exec cp {} ~/test-results/junit/ \;
          when: always
      - store_test_results:
          path: ~/test-results
      - store_artifacts:
          path: ~/test-results/junit    
      
     - store_artifacts: # uploads the log files
      # Upload test summary for display in Artifacts: https://circleci.com/docs/2.0/artifacts/
          path: logs
                 
      
      # See https://circleci.com/docs/2.0/deployment-integrations/ for deploy examples  